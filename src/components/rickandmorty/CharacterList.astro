---
import Layout from '../../layouts/Layout.astro';
import PaginationR from '../PaginationR.astro';

const apiUrl = 'https://rickandmortyapi.com/api/character';

// Obtener parámetros de la URL
const url = new URL(Astro.url.pathname + Astro.url.search, Astro.url.origin);
const pageParam = Number(url.searchParams.get('page') ?? 1);
const itemsPerPage = 20; // Número de personajes por página (máximo permitido por la API)
const currentPage = Math.max(pageParam, 1);

// Realiza la solicitud a la API para la página actual
const res = await fetch(`${apiUrl}?page=${currentPage}`);
const data = await res.json();
const characters = data.results;
const totalPages = data.info.pages;

interface Character {
  id: number;
  name: string;
  status: string;
  species: string;
  gender: string;
  origin: {
    name: string;
  };
  location: {
    name: string;
  };
  image: string;
}
---
<Layout>
<div class="container mx-auto p-8">
  <h1 class="text-4xl font-bold text-valorant mb-8">Rick and Morty Characters</h1>

  <!-- Lista de personajes para la página actual -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-8">
    {
      characters.map((character: Character) => (
        <Fragment key={character.id}>
          <a href={`/rickandmorty/characters/${character.id}`} class="block bg-valorant-dark p-4 rounded-lg shadow-lg hover:shadow-2xl transition-shadow duration-300">
            <img src={character.image} alt={character.name} class="w-full h-48 object-contain mb-4 rounded-lg" loading="lazy" />
            <h2 class="text-2xl font-semibold text-valorant mb-2">{character.name}</h2>
            <p class="text-lg">Status: {character.status}</p>
            <p class="text-lg">Species: {character.species}</p>
            <p class="text-lg">Gender: {character.gender}</p>
            <p class="text-lg">Origin: {character.origin.name}</p>
            <p class="text-lg">Location: {character.location.name}</p>
          </a>
        </Fragment>
      ))
    }
  </div>

  <!-- Componente de paginación -->
  <PaginationR totalPages={totalPages} currentPage={currentPage} />
</div>
</Layout>